<header>
    <!-- MIGRATION_PENDING <form (ngSubmit)="search()" [formGroup]="searchForm" autocomplete="off">
         <div class="field">
         <input type="search" formControlName="query"/>
         </div>
         <div class="field">
         <button [disabled]="searchForm.invalid">Search</button>
         </div>
         <div *ngIf="query.value" class="field reset">
         <a href="#" (click)="clearSearch($event)">Clear Search</a>
         </div>
         </form> -->
    <app-button label="Add transaction" icon="add" routerLink="/transactions/new"></app-button>
</header>

<!-- MIGRATION_PENDING <h1 *ngIf="tag || activeQuery">Transaction Search Results</h1>
     <h1 *ngIf="!tag && !activeQuery">Transactions</h1>

     <div class="pager">
     <div></div>
     <div *ngIf="count > 0">{{ this.offset + 1}} to {{ this.offset + transactions.length }} of {{ count|number }}</div>
     <div></div>
     </div>-->
<table>
    @for (transaction of (transactions$ | async); track transaction.id) {

    @if ($first) {
    <thead>
        <tr>
            <th>ID</th>
            <th class="align-right">Amount</th>
            <th>Date</th>
            <th>Account</th>
            <th>Type</th>
            <th>Details</th>
            <th class="align-center">Status</th>
        </tr>
    </thead>
    }
    <tr [class]="transaction.rowClasses" (click)="toggleSelection($event, transaction)">
        <td>
            <a class="nowrap" [routerLink]="['/transactions', transaction.id, 'edit']">{{ transaction.id }}</a>
        </td>
        <td class="align-right nowrap">
            {{ transaction.amount | currency }}
        </td>
        <td class="nowrap">
            {{ transaction.occurred_on|date:'longDate' }}
        </td>
        <td class="nowrap">
            @if (transaction.account) {
            {{ transaction.account.name }}
            }

            @if (transaction.isTransfer) {
            <div>↓</div>
            }

            @if (transaction.destination) {
            {{ transaction.destination.name }}
            }
        </td>
        <td class="nowrap">{{ transaction.transactionType }}</td>
        <td>
            @if (transaction.payee) {
            <p>{{ transaction.payee }}</p>
            } @else {
            <p>No payee</p>
            }

            @if (transaction.note) {
            <p><em>{{ transaction.note }}</em></p>
            }

            @if (transaction.receipt_mime) {
            <p>
                <a target="_blank" href="/ledger/receipts/{{ transaction.id }}">
                    <svg class="icon"><use xlink:href="#icon-file"></use></svg> receipt
                </a>
            </p>
            }
            <!-- MIGRATION_PENDING
                 <ul class="tag-list" *ngIf="transaction.tags">
                 <li *ngFor="let tag of transaction.tags; first as isFirst">
                 <svg *ngIf="isFirst" class="icon"><use xlink:href="#icon-tag"></use></svg>
                 <a [routerLink]="['/transactions']" [queryParams]="{q: 'tags:' + tag}">{{ tag }}</a>
                 </li>
                 </ul> -->
        </td>
        <td class="align-center">
            @if (transaction.cleared_on) {
            <div class="minibanner">Cleared</div>
            } @else {
            <div class="minibanner">Pending</div>
            <p><a href="#" (click)="clearTransaction($event, transaction)">Mark cleared</a></p>
            }
        </td>
    </tr>
    } @empty {
    <tr>
        <td><p>There are no transactions to display.</p></td>
    </tr>
    }
</table>

<!-- MIGRATION_PENDING
<div class="pager">
    <div>
        <a *ngIf="this.offset > 0" [routerLink]="[]" [queryParams]="{offset: 0}" queryParamsHandling="merge">
            ⏪️  <span>Newest</span>
        </a>
        <a *ngIf="this.offset > 0" [routerLink]="[]" [queryParams]="{offset: previousOffset}" queryParamsHandling="merge">
            ⬅️  <span>Newer</span>
        </a>
    </div>
    <div></div>
    <div>
        <a *ngIf="nextOffset < count" [routerLink]="[]" [queryParams]="{offset: nextOffset}" queryParamsHandling="merge">
            <span>Older</span> ➡️
        </a>
        <a *ngIf="nextOffset < count" [routerLink]="[]" [queryParams]="{offset: count - transactions.length}" queryParamsHandling="merge">
            <span>Oldest</span> ⏩
        </a>
    </div>
</div>

-->
